import requests
import threading
import xml.etree.ElementTree as ET

# 假设你的 XML 数据如下
xml_data = """
            <root>
<file name="MSG4-SEVI-MSG15-0100-NA-20211019105741.051000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019105741.051000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019104241.334000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019104241.334000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019102741.617000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019102741.617000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019101241.901000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019101241.901000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019095742.185000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019095742.185000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019094242.469000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019094242.469000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019092742.754000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019092742.754000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019091241.834000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019091241.834000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019085742.120000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019085742.120000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019084242.405000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019084242.405000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019082742.692000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019082742.692000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019081242.978000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019081242.978000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019075741.457000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019075741.457000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019074241.744000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019074241.744000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019072742.031000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019072742.031000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019071242.318000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019071242.318000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019065742.606000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019065742.606000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019064242.893000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019064242.893000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019062741.975000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019062741.975000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019061242.263000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019061242.263000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019055742.550000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019055742.550000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019054242.838000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019054242.838000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019052741.920000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019052741.920000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019051242.208000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019051242.208000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019045742.495000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019045742.495000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019044242.782000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019044242.782000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019042743.069000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019042743.069000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019041241.549000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019041241.549000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019035741.835000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019035741.835000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019034242.122000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019034242.122000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019032742.409000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019032742.409000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019031242.695000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019031242.695000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019025742.982000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019025742.982000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019024243.268000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019024243.268000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019022741.746000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019022741.746000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019021242.032000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019021242.032000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019015742.318000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019015742.318000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019014242.603000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019014242.603000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019012742.888000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019012742.888000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019011243.173000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019011243.173000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019005741.651000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019005741.651000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019004241.935000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019004241.935000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019002742.220000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019002742.220000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211019001242.505000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211019001242.505000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018235742.789000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018235742.789000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018234243.073000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018234243.073000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018232741.549000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018232741.549000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018231241.833000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018231241.833000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018225742.117000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018225742.117000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018224242.401000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018224242.401000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018222742.685000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018222742.685000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018221242.969000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018221242.969000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018215741.444000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018215741.444000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018214241.728000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018214241.728000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018212742.011000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018212742.011000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018211242.294000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018211242.294000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018205742.578000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018205742.578000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018204242.861000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018204242.861000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018202743.145000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018202743.145000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018201241.620000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018201241.620000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018195741.903000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018195741.903000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018194242.187000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018194242.187000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018192742.470000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018192742.470000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018191242.754000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018191242.754000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018185741.230000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018185741.230000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018184241.514000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018184241.514000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018182741.798000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018182741.798000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018181242.083000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018181242.083000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018175742.367000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018175742.367000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018174242.652000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018174242.652000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018172742.937000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018172742.937000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018171242.017000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018171242.017000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018165742.302000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018165742.302000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018164242.588000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018164242.588000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018162742.875000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018162742.875000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018161241.956000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018161241.956000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018155742.242000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018155742.242000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018154242.530000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018154242.530000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018152741.612000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018152741.612000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018151241.901000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018151241.901000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018145742.189000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018145742.189000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018144242.478000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018144242.478000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018142742.768000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018142742.768000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018141243.058000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018141243.058000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018135741.540000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018135741.540000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018134241.831000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018134241.831000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018132742.123000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018132742.123000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018131242.414000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018131242.414000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018125742.707000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018125742.707000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018124243.000000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018124243.000000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018122741.486000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018122741.486000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018121241.780000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018121241.780000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018115742.075000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018115742.075000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018114242.370000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018114242.370000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018112742.666000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018112742.666000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018111242.962000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018111242.962000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018105741.450000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018105741.450000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018104241.748000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018104241.748000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018102742.045000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018102742.045000000Z-NA</url></file><file name="MSG4-SEVI-MSG15-0100-NA-20211018101242.344000000Z-NA.zip"><url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018101242.344000000Z-NA</url></file>
<file name="MSG4-SEVI-MSG15-0100-NA-20211018121241.780000000Z-NA.zip">
    <url>https://api.eumetsat.int/data/download/1.0.0/collections/EO%3AEUM%3ADAT%3AMSG%3AHRSEVIRI/products/MSG4-SEVI-MSG15-0100-NA-20211018121241.780000000Z-NA</url>
    </file>
    
            </root>
"""
token = '?access_token=e446fa03-3a34-333b-ad64-6dc8185026ef'
savepath = '/data/'
# 解析 XML 数据
root = ET.fromstring(xml_data)

# 找到所有的 <file> 元素
files = root.findall('file')

# 初始化两个列表来存储文件名和 URL
file_names = []
urls = []

# 遍历所有的 <file> 元素
for file_element in files:
    file_name = file_element.get('name')  # 获取文件名
    url_element = file_element.find('url')  # 查找 <url> 子元素
    if url_element is not None:
        url = url_element.text  # 获取 URL 文本内容
        file_names.append(file_name)
        urls.append(url)
import time
import os
def get_eu_file(url, filename, token):
    try:
        # 检查文件是否已经存在
        if os.path.exists(savepath + filename):
            print(f"文件已存在，跳过下载：{filename}")
            return
        response = requests.get(url + token, stream=True, timeout=30)
        response.raise_for_status()  # 检查请求是否成功
        with open( savepath + filename , 'wb') as f:
            for chunk in response.iter_content(chunk_size=8192):
                if chunk:
                    f.write(chunk)
        print(f"下载完成：{filename}")
    except requests.exceptions.HTTPError as e:
        if e.response.status_code == 429:
            retry_after = int(e.response.headers.get("Retry-After", 60))  # 默认等待60秒
            print(f"请求过于频繁，等待 {retry_after} 秒后重试...")
            time.sleep(retry_after)
            get_eu_file(url, filename, token, savepath)  # 递归重试
        else:
            print(f"下载失败，HTTP 错误：{e}")
    except requests.exceptions.RequestException as e:
        print(f"下载失败：{e}")
        # 如果下载失败并且该文件未下载完，则删除不完整的文件
        if os.path.exists(savepath + filename):
            os.remove(savepath + filename)
            print(f"删除不完整的文件：{filename}")
        # 等待10秒后重试
        time.sleep(10)
        get_eu_file(url, filename, token, savepath)  # 递归重试
def download_file(url, filename, token, sem):
    sem.acquire()
    try:
        get_eu_file(url, filename, token)
    finally:
        sem.release()
# 设置最大线程数
max_threads = 5
sem = threading.Semaphore(max_threads)

# 启动多线程下载
for url, filename in zip(urls, file_names):
    thread = threading.Thread(target=download_file, args=(url, filename, token, sem))
    thread.start()
